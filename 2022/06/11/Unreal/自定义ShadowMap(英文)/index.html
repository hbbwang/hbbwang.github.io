
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="utf-8" />
    <title>è‡ªå®šä¹‰ShadowMap(è‹±æ–‡) | ååŒ…åŒ…</title>
    <meta name="author" content="ååŒ…åŒ…" />
    <meta name="description" content="ååŒ…åŒ…çš„ä¸ªäººåšå®¢" />
    <meta name="keywords" content="" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0"
    />
    <link rel="icon" href="/images/Icon.jpg" />
    <link rel="preconnect" href="https://s4.zstatic.net" />
<script src="https://s4.zstatic.net/ajax/libs/vue/3.3.7/vue.global.prod.min.js"></script>
<link rel="stylesheet" href="https://s4.zstatic.net/ajax/libs/font-awesome/6.4.2/css/all.min.css" />
<link rel="preconnect" href="https://fonts.googleapis.cn" />
<link rel="preconnect" href="https://fonts.gstatic.cn" crossorigin />
<link
    rel="stylesheet"
    href="https://fonts.googleapis.cn/css2?family=Fira+Code:wght@400;500;600;700&family=Lexend:wght@400;500;600;700;800;900&family=Noto+Sans+SC:wght@400;500;600;700;800;900&display=swap"
/>
<script> const mixins = {}; </script>

<script src="https://polyfill.alicdn.com/v3/polyfill.min.js?features=default"></script>




<script src="/js/lib/preview.js"></script>



<script src="/js/lib/search.js"></script>







<link rel="stylesheet" href="/css/main.css" />


    
<link
    rel="stylesheet"
    href="/css/prism.css"
/>
<script src="/js/lib/prism.js"></script>

<meta name="generator" content="Hexo 7.2.0"></head>
<body>
    <div id="layout">
        <transition name="fade">
            <div id="loading" v-show="loading">
                <div id="loading-circle">
                    <h2> LOADING </h2>
                    <p>...åŠ è½½ä¸­...</p>
                    <!-- <img src="/images/loading3.gif" data-original="/images/loading2.gif" style="filter:brightness(0.75) grayscale(0.65) blur(1px);"  /> -->
                    <div style="background-image:url(/images/loading2.gif);" class="loading-image" ></div>
                </div>
            </div>
        </transition>
        <div id="menu" :class="{ hidden: hiddenMenu, 'menu-color': menuColor}">
    <nav id="desktop-menu">
        <a class="title" href="/">
            <span>ååŒ…åŒ…</span>
        </a>
        
        <a href="/">
            <i class="fa-solid fa-house fa-fw"></i>
            <span>&ensp;Home</span>
        </a>
        
        <a href="/categories/Unreal">
            <i class="fa-solid fa-Unreal fa-fw"></i>
            <span>&ensp;Unreal</span>
        </a>
        
        <a href="/categories/Others">
            <i class="fa-solid fa-Others fa-fw"></i>
            <span>&ensp;Others</span>
        </a>
        
    </nav>
    <nav id="mobile-menu">
        <div class="title" @click="showMenuItems = !showMenuItems">
            <i class="fa-solid fa-bars fa-fw"></i>
            <span>&emsp;ååŒ…åŒ…</span>
        </div>
        <transition name="slide">
            <div class="items" v-show="showMenuItems">
                
                <a href="/">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-house fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Home</div>
                    </div>
                </a>
                
                <a href="/categories/Unreal">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-Unreal fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Unreal</div>
                    </div>
                </a>
                
                <a href="/categories/Others">
                    <div class="item">
                        <div style="min-width: 20px; max-width: 50px; width: 10%">
                            <i class="fa-solid fa-Others fa-fw"></i>
                        </div>
                        <div style="min-width: 100px; max-width: 150%; width: 20%">Others</div>
                    </div>
                </a>
                
            </div>
        </transition>
    </nav>
</div>
<transition name="fade">
    <div id="menu-curtain" @click="showMenuItems = !showMenuItems" v-show="showMenuItems"></div>
</transition>

        <div id="main" :class="loading ? 'into-enter-from': 'into-enter-active'">
            <!-- ç›®å½•å¡ç‰‡ -->
<script>
    
    document.addEventListener('DOMContentLoaded', function() {
        const target = document.getElementById('toc-style');
        const button = document.getElementById('toc-button');  
        target.style.display = 'none';
        button.textContent = 'æ˜¾ç¤ºç›®å½•';

        const home = document.getElementById('home-toc');
        home.style.display = 'none';

        setTimeout(()=>{
            const home = document.getElementById('home-toc');
            home.style.display = 'block';
        },800);
    });
    
    function onButtonClick() 
    {
        const target = document.getElementById('toc-style');
        const button = document.getElementById('toc-button');  
        if(target.style.display == 'none')
        {
            target.style.display = 'block';
            button.textContent = 'éšè—ç›®å½•';
        }
        else
        {
            target.style.display = 'none';
            button.textContent = 'æ˜¾ç¤ºç›®å½•';
        }

    }
</script>
<div id="home-toc" class="toc-article">
    <button id="toc-button" class="toc-button" onclick="onButtonClick()">æ˜¾ç¤ºç›®å½•</button>
    <div id="toc-style">
        <!-- <div class="toc-title">ç›®å½•</div> -->
        
    </div>
</div>
<div class="article">
    <!-- åªæœ‰è®¾ç½®äº†imageå‚æ•°æ‰ä¼šåŠ è½½å¤´å›¾ -->
    
    <img src=Header.jpg class="post-image no-lazy" alt="" ></img>
    
    
    <div class="post-title-parent">
        <h1 class="post-title">è‡ªå®šä¹‰ShadowMap(è‹±æ–‡)</h1>
    </div>
    <div class="info">
        <span class="date">
            <span class="icon">
                <i class="fa-solid fa-calendar fa-fw"></i>
            </span>
            2022/6/11
        </span>
        
        <span class="category">
            <a href="/categories/Unreal/">
                <span class="icon">
                    <i class="fa-solid fa-bookmark fa-fw"></i>
                </span>
                Unreal
            </a>
        </span>
        
        
        <span class="tags">
            <span class="icon">
                <i class="fa-solid fa-tags fa-fw"></i>
            </span>
            
            
            <span class="tag">
                
                <a href="/tags/Unreal/" style="color: #00bcd4">
                    Unreal
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/UnrealEngine/" style="color: #ffa2c4">
                    UnrealEngine
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/%E6%B8%B2%E6%9F%93/" style="color: #ff7d73">
                    æ¸²æŸ“
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/%E9%98%B4%E5%BD%B1/" style="color: #00a596">
                    é˜´å½±
                </a>
            </span>
            
            <span class="tag">
                
                <a href="/tags/%E5%8A%A8%E6%80%81%E9%98%B4%E5%BD%B1/" style="color: #00bcd4">
                    åŠ¨æ€é˜´å½±
                </a>
            </span>
            
        </span>
        
    </div>
    
    <div class="content" v-pre>
        <p><span style="color:rgb(160,250,150);" >PS:æ–‡ç« æ˜¯2018å¹´å†™çš„ï¼Œä¿å­˜çš„ä¸æ˜¯å¾ˆå¥½ï¼Œå›¾ç‰‡å·²ç»å¾ˆæ¨¡ç³Šäº†ï¼Œå»ºè®®ç›´æ¥å»çœ‹æˆ‘çš„è§†é¢‘ï¼Œä¸€å…±å››æœŸï¼š</span><br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1544y177sh?spm_id_from=333.999.0.0&vd_source=ac34bbe36af835db8452b6636f002bd2">https://www.bilibili.com/video/BV1544y177sh?spm_id_from=333.999.0.0&amp;vd_source=ac34bbe36af835db8452b6636f002bd2</a><br><br>This dairy was modified on Sep. sixth 2018.<br><br>Hello everyone ,we met again.This article will tell everyone how to make the custom shadow of directional light in Unreal Engine 4.Next I did not talk about any trashy things.Letâ€™s start to make it.<br><br>I need to say if you want to make custom shadow,you have to get some knowledge about the Matrix. There is a nice book everyone can read.Its name is 3D math primer for Graphics and Game development.This article did not talk about the Matrix knowledge for the 3D math.So if you can not understand,when you read below article, you will be giddy.<br><br>First Create the new level and delete some things about Unreal Engine default lighting.Create the other simple shape for our reference.<br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="1.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br>Create the new material for custom shadow.And Set shading model to Unlit.<br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="2.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br>Now we need a render target to capture the depth of the scene.It work like the tutorial in internet.I did not talk about its theory,because there are so many tutorials about it.Below URL are the tutorials of the DirectX 11 shadow map:<br><br>â‘ (Chinese) <br><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_29523119/article/details/53056755">https://blog.csdn.net/qq_29523119/article/details/53056755</a><br><br>â‘¡(English)<br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=3AdLu0PHOnE">https://www.youtube.com/watch?v=3AdLu0PHOnE</a><br><br>â‘¢(Cantonese!?!??OMG å¹¿å·è¯)<br><a target="_blank" rel="noopener" href="https://www.youtube.com/watch?v=oPxY1eTrrOo">https://www.youtube.com/watch?v=oPxY1eTrrOo</a><br><br>Create render target and set <br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="3.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="4.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br>Create a blueprint of Actor.And Create a scene capture component 2D.Set it for the render target.The projection Type is orthographic.because we only make the directional light shadow.<br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="5.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="6.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br>Sample the render target and watch the effect.it is the strong light in the scene.Because it is scene depth,the vertexes distance the camera.Not the from zero to one.So we should divide the distance.Create a parameter collection,and create some parameter as we will need.One position and two matrix parameters.Create a custom event in blueprint and run it on the construction script.<br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="7.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="8.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="9.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="10.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="11.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="12.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="13.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="14.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br>Alright, now we can see the capture map was pasted the shape.But show type was wrong.So this is why we need the Matrix to transform.My matrix constructions are build in blueprint.Unreal Engine as same as many Engines are the left handed coordinate system. So the Y axis is the up vector,X axis is the right vector,Z axis is the forward vector.We can not get the camera space space and its projection space easily in blueprint.So we only make these matrixes by ourselves.There are two matrixes function in the DirectXMath source code.They can help us to transform the space.  <br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="15.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="16.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><p style="text-align:center;"><span style="" >Projection Matrix  â†“</span></p><br>However in the  projection space the zero point of the  axis system is on the left-down side.We can debug the mouse position.We can see the upleft side is the zero point.So we shoud add a minus sign at the Y axis.And here, in the projection space,the W vector is not matter,we can discard it.I only folllow the equation to make the matrix.<br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="17.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><p style="text-align:center;"><span style="" >Debug the mouse position</span></p><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="18.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><p style="text-align:center;"><span style="" >(I am sorry i cant catch the arrows of the mouse.I only draw it. XD)</span></p><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="19.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="20.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><p style="text-align:center;"><span style="" >Material Editor</span></p><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="21.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><p style="text-align:center;"><span style="" >Result</span></p><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="22.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br>Next we use the scene depth to contract the shadow map,and draw the shadow.<br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="23.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><p style="text-align:center;"><span style="" >Shadow Acne(Bias 0.0)</span></p><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="24.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><p style="text-align:center;"><span style="" >Bias 0.001</span></p><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="25.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br><div  style="display: flex;justify-content: center;text-align: center;"  ><img src="/images/loading3.gif" data-original="26.png" style="filter:brightness(0.75) grayscale(0.65) blur(1px);" ></div><br>If I have some things to update for this article,I will follow up.<br><br>Have fun ğŸ™‚<br><br><br></p>

    </div>
    
    
    
    
    <div id="comment">
        <div id="giscus-container" class="giscus"></div>
    </div>
    
    
    
    

    <script>
        document.addEventListener('DOMContentLoaded', function() {
        const OFFSET_HEIGHT = 100; // æ–‡ç« è°ƒæ•´çš„æ—¶å€™é¿å¼€é¡¶ä¸Šçš„èœå•æ 
        const links = document.querySelectorAll('a[href^="#"]');
        links.forEach(function(link) {
            link.addEventListener('click', function(event) {
            const href = link.getAttribute('href');
            const decodedHref = decodeURIComponent(href.slice(1));
            const target = document.getElementById(decodedHref);
            console.log(decodedHref);
            if (target) {
                event.preventDefault();
                const targetPosition = target.getBoundingClientRect().top + window.pageYOffset;
                window.scrollTo({ top: targetPosition - OFFSET_HEIGHT, behavior: 'smooth' });
            }

            const toc_style = document.getElementById('toc-style');
            const toc_button = document.getElementById('toc-button');  
            toc_style.style.display = 'none';
            toc_button.textContent = 'æ˜¾ç¤ºç›®å½•';

            });
        });
        });
    </script>

</div>

            <footer id="footer">
    <div id="footer-wrap">
        <div>
            &copy;
            2022 - 2024 ååŒ…åŒ…
            <span id="footer-icon">
                <i class="fa-solid fa-font-awesome fa-fw"></i>
            </span>
            &commat;ååŒ…åŒ…
            <br/>
            <a class="BilibliLink"  onclick="scrollToTop()">è¿”å›é¡¶éƒ¨</a>
            <br/>
            <a class="BilibliLink" href="/">è¿”å›ä¸»é¡µ</a>
            <br/>
            <a class="BilibliLink" target="_blank" rel="noopener" href="https://space.bilibili.com/3157352">ååŒ…åŒ…çš„ Bilibili ä¸»é¡µ</a>
            <br/>
            æœ¬é¡µé¢ç”±Hexoç”Ÿæˆï¼Œæ­å»ºåœ¨Github
            <br/>
            ä¸»é¢˜ï¼šParticlex(é­”æ”¹)
        </div>
        
    </div>
    <script>
        // æ»šåŠ¨äº‹ä»¶ç›‘å¬å™¨ï¼Œç”¨äºæ˜¾ç¤º/éšè—è¿”å›é¡¶éƒ¨æŒ‰é’®
        // window.onscroll = function() {
        //   if (document.body.scrollTop > 20 || document.documentElement.scrollTop > 20) {
        //     document.getElementById('backToTop').style.display = 'block';
        //   } else {
        //     document.getElementById('backToTop').style.display = 'none';
        //   }
        // };
       
        // è¿”å›é¡¶éƒ¨çš„å‡½æ•°
        function scrollToTop() {
          document.body.scrollTop = 0; // å¯¹Safari
          document.documentElement.scrollTop = 0; // å¯¹Chrome, Firefox, IE å’Œ Opera
        }
      </script>
</footer>
        </div>
        
        <transition name="fade">
            <div id="preview" ref="preview" v-show="previewShow">
                <img id="preview-content" alt="" ref="previewContent" />
            </div>
        </transition>
        
    </div>
    <script src="/js/main.js"></script>
    
    
<script
    src="https://giscus.app/client.js"
    data-repo="hbbwang/HbbHexoComment"
    data-repo-id="R_kgDOMC9ptw"
    data-category="Announcements"
    data-category-id="DIC_kwDOMC9pt84Cfv5q"
    data-mapping="pathname"
    data-strict="0"
    data-reactions-enabled="1"
    data-emit-metadata="0"
    data-input-position="bottom"
    data-theme="noborder_dark"
    data-lang="zh-CN"
    
    data-loading="lazy"
    
    crossorigin
    async
></script>





    

        <style>
            [bg-lazy] {
                background-image: none !important;
                background-color: #eee !important;
            }
        </style>
        <script>
            window.imageLazyLoadSetting = {
                isSPA: true,
                preloadRatio: 1,
                processImages: null,
            };
        </script><script>window.addEventListener("load",function(){var t=/\.(gif|jpg|jpeg|tiff|png)$/i,r=/^data:image\/[a-z]+;base64,/;Array.prototype.slice.call(document.querySelectorAll("img[data-original]")).forEach(function(a){var e=a.parentNode;"A"===e.tagName&&(e.href.match(t)||e.href.match(r))&&(e.href=a.dataset.original)})});</script><script>!function(r){r.imageLazyLoadSetting.processImages=t;var a=r.imageLazyLoadSetting.isSPA,o=r.imageLazyLoadSetting.preloadRatio||1,d=n();function n(){var t=Array.prototype.slice.call(document.querySelectorAll("img[data-original]")),e=Array.prototype.slice.call(document.querySelectorAll("[bg-lazy]"));return t=t.concat(e)}function t(t){(a||t)&&(d=n());for(var e,i=0;i<d.length;i++)0<=(e=(e=d[i]).getBoundingClientRect()).bottom&&0<=e.left&&e.top<=(r.innerHeight*o||document.documentElement.clientHeight*o)&&function(){var t,e,a,o,n=d[i];e=function(){d=d.filter(function(t){return n!==t}),r.imageLazyLoadSetting.onImageLoaded&&r.imageLazyLoadSetting.onImageLoaded(n)},(t=n).dataset.loaded||(t.hasAttribute("bg-lazy")?(t.removeAttribute("bg-lazy"),e&&e()):(a=new Image,o=t.getAttribute("data-original"),a.onload=function(){t.src=o,t.removeAttribute("data-original"),t.setAttribute("data-loaded",!0),t.removeAttribute("style"),e&&e()},a.onerror=function(){t.removeAttribute("data-original"),t.setAttribute("data-loaded",!1),t.src=o},t.src!==o&&(a.src=o)))}()}function e(){clearTimeout(t.tId),t.tId=setTimeout(t,100)}t(),document.addEventListener("scroll",e),r.addEventListener("resize",e),r.addEventListener("orientationchange",e)}(this);</script></body>
</html>
